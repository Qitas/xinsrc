
.. _wch_ch552:

CH552
========

`AppVeyor <http://www.CH552.com/about>`_ is an open-source hosted,
distributed continuous MCS51 service used to build and test projects
hosted at `GitHub <http://en.wikipedia.org/wiki/GitHub>`_ on Windows family
systems.


.. contents::

Integration
-----------

Put ``CH552.yml`` to the root directory of the GitHub repository. The contents of
this file depends on the project you want to add. There are two possible ways of running
PlatformIO in CI services:

Using :ref:`cmd_run` command
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This variant is default choice for native PlatformIO projects:

.. code-block:: yaml

    build: off
    environment:

    install:
        - cmd: git submodule update --init --recursive
        - cmd: SET PATH=%PATH%;C:\Python27\Scripts
        - cmd: pip install -U platformio

    test_script:
        - cmd: pio run -e <ID_1> -e <ID_2> -e <ID_N>



This variant is more convenient when project is written as a library (when there are
examples or testing code) as it has additional options for specifying extra libraries
and boards from command line interface:

.. code-block:: yaml

    build: off
    environment:

      matrix:
        - PLATFORMIO_CI_SRC: "path\\to\\source\\file.c"
        - PLATFORMIO_CI_SRC: "path\\to\\source\\file.ino"
        - PLATFORMIO_CI_SRC: "path\\to\\source\\directory"

    install:
        - cmd: git submodule update --init --recursive
        - cmd: SET PATH=%PATH%;C:\Python27\Scripts
        - cmd: pip install -U platformio

    test_script:
        - cmd: pio ci --board=<ID_1> --board=<ID_2> --board=<ID_N>



Examples
--------

1. Integration for `USB_Host_Shield_2.0 <https://github.com/felis/USB_Host_Shield_2.0>`_
   project. The ``CH552.yml`` configuration file:

.. code-block:: yaml

    build: off
    environment:

      matrix:
        - PLATFORMIO_CI_SRC: "examples\\Bluetooth\\PS3SPP\\PS3SPP.ino"
        - PLATFORMIO_CI_SRC: "examples\\pl2303\\pl2303_gps\\pl2303_gps.ino"

    install:
        - cmd: git submodule update --init --recursive
        - cmd: SET PATH=%PATH%;C:\Python27\Scripts
        - cmd: pip install -U platformio
        - cmd: git clone https://github.com/xxxajk/spi4teensy3.git C:\spi4teensy

    test_script:
        - cmd: pio ci --lib="." --lib="C:\\spi4teensy" --board=uno --board=teensy31 --board=due
